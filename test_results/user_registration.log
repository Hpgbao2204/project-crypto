=== Test: user_registration ===
Date: Wed May 28 02:22:33 EDT 2025
Command: cd /home/ubuntu/martsia_project/web_app && python3 -c "
from src.main import app, db
from src.models.user import User
from werkzeug.security import generate_password_hash
import json

with app.app_context():
    # Create test users with different roles and attributes
    test_users = [
        {
            'username': 'doctor_user',
            'email': 'doctor@example.com',
            'password': generate_password_hash('password123'),
            'role': 'reader',
            'attributes': [{'name': 'Doctor', 'authority_name': 'Hospital'}]
        },
        {
            'username': 'admin_user',
            'email': 'admin@example.com',
            'password': generate_password_hash('password123'),
            'role': 'data_owner',
            'attributes': [{'name': 'Admin', 'authority_name': 'Hospital'}]
        },
        {
            'username': 'researcher_user',
            'email': 'researcher@example.com',
            'password': generate_password_hash('password123'),
            'role': 'reader',
            'attributes': [{'name': 'Researcher', 'authority_name': 'Hospital'}]
        },
        {
            'username': 'doctor_researcher',
            'email': 'dr_researcher@example.com',
            'password': generate_password_hash('password123'),
            'role': 'data_owner',
            'attributes': [
                {'name': 'Doctor', 'authority_name': 'Hospital'},
                {'name': 'Researcher', 'authority_name': 'Hospital'}
            ]
        }
    ]
    
    for user_data in test_users:
        # Check if user already exists
        existing_user = User.query.filter_by(username=user_data['username']).first()
        if existing_user:
            print(f'User {user_data[\"username\"]} already exists')
            continue
            
        # Create new user
        user = User(
            username=user_data['username'],
            email=user_data['email'],
            password=user_data['password'],
            role=user_data['role']
        )
        
        # Add attributes
        for attr in user_data['attributes']:
            user.add_attribute(attr['name'], attr['authority_name'])
        
        db.session.add(user)
        print(f'Created user: {user_data[\"username\"]} with attributes: {json.dumps([{\"name\": a[\"name\"], \"authority\": a[\"authority_name\"]} for a in user_data[\"attributes\"]])}')
    
    db.session.commit()
    print('Test users created successfully')
"
---
User doctor_user already exists
User admin_user already exists
User researcher_user already exists
User doctor_researcher already exists
Test users created successfully
Exit status: 0
PASS
